<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Week11 Emotional Data</title>
</head>

<body>

	<div class="container">
    	<div id='canvas'></div>
  	</div>

	<style>
		.container{
  			width: 100%;
  			margin: 0 auto;
		}
		#canvas{width: 100%;min-height:600px}
		
		path, line{
		  stroke-linecap: round;
		}

	</style>

	<script>


		//prepare canvas
		var canvas = document.getElementById('canvas');
		var xmlns='http://www.w3.org/2000/svg';
		var plot=document.createElementNS(xmlns,'svg');
		var w=canvas.clientWidth, h=canvas.clientHeight;
		plot.id='svg';
		plot.setAttribute('xmlns',xmlns);
		plot.setAttribute('width',w);
		plot.setAttribute('height',h);

		document.getElementById('canvas').appendChild(plot);
		console.log(canvas.clientWidth,canvas.clientHeight,plot.width,plot.height);

		//draw cur
		function line(x1,x2,y1,y2,color,width,name){
		   const line=document.createElementNS(xmlns,'line');
		    line.style.transition='transform 2s'
		    line.setAttribute('x1',x1)
		    line.setAttribute('y1',y1)
		    line.setAttribute('x2',x2)
		    line.setAttribute('y2',y2)
		    line.setAttribute('data-name',name)
		    line.style.strokeWidth=width;
		    line.style.stroke=color;
		return line
		}


		function strip(x1,x2,y1,y2,color,width,name){
		   const strip=document.createElementNS(xmlns,'line');
		    strip.style.transition='transform 2s'
		    strip.setAttribute('x1',x1)
		    strip.setAttribute('y1',y1)
		    strip.setAttribute('x2',x2)
		    strip.setAttribute('y2',y2)
		    strip.setAttribute('data-name',name)
		    strip.style.strokeWidth=width;
		    strip.style.stroke=color;
		return strip
		};

		var alldata={};
		
		
		function dataloaded(data,name){
			alldata[name]=data; //store data to object and use them by property name.
			const portionY=(h-50)/60;
  			const portionX=(w-80)/(14*7);
			console.table(alldata.main);

//
			jobkey.forEach((el,i)=>{
			    const portion=(w-60)/12.25;   
			    document.getElementById('svg').appendChild(strip(i*portion+20,(i+el.portion)*portion,h-10,h-10,el.color,10,'often'));
			})

			alldata.main.forEach((data,i)=>{
				var stripcolor=jobkey.find(el=>el.id==data.job).color;
			    const g=document.createElementNS(xmlns,'g');

			    g.style.transform=`translate(${x}px,${y}px)`;

			    const point=document.createElementNS(xmlns,'circle');

			    point.setAttribute('cx',0);
			    point.setAttribute('cy',0);
			    point.setAttribute('r',3);
			    point.style.fill=pointcolor;
			    g.appendChild(point); 

			    for (var i=0;i<3;i++){
			      var offset;
			      if(data.type==3&&data.learned==5){
			        offset=level*5+2;
			      }else{
			        offset=-level*5;
			      }
			      g.appendChild(strip(i*5+offset,i*5+offset-4,-i*5+offset,-i*5+offset-4,stripcolor,4,'strip'))
			    }      
			    g.insertBefore(drawcur(0,0,level,curcolor),g.firstChild);
			    document.getElementById('svg').appendChild(g);

			})

		}

		const svg=document.querySelector('svg')

		//animation


		//get the data
		const files=[{file:'emotion.csv',parse:'maindata',name:'main'}];
//Question: what is below?
		function call_user_func(method, params){
		  func = window[method];
		  return func.apply(method, params);
		}

		files.forEach((file)=>{
  		const filepath=file.file;
		const parsemethod=file.parse;
		const name=file.name;
		
		fetch(filepath).then(response=>response.text())//get the whole content of file as text
		.then(text=>{
			var allTextLines = text.split(/\r\n|\n/);//break whole text to rows
			var lines = [];
			var data=[];
			for (var i=1; i<allTextLines.length; i++) {
			var row = allTextLines[i].split(',');//break each rows to array
			data.push(call_user_func(parsemethod,[row]))   
		};  
		  dataloaded(data,name);//data-store function
		})
		})

		var alldata={};
		function dataloaded(data,name){
		  	alldata[name]=data;//store data to object and use them by property name.
		}



		//define your own data as we do in d3 parse function
		function maindata(row){
			return{      
			    situation: +row[0],
			    job: +row[1],
			    order: +row[2],
			    emotion: +row[3],
			    weather: +row[4],
			    people1: +row[5],
			    people2: +row[6],
			    people3: +row[7],
		    }
		}

		//set the keys
		const emotionkey=[
		    {id:1,emotion:'unproductive',color:'#fdf63c'},
		    {id:2,emotion:'stressed',color:'#fda135'},
		    {id:3,emotion:'anxious',color:'#f9201f'},
		    {id:4,emotion:'confused',color:'#c51124'},
		    {id:5,emotion:'just ok!',color:'#fc715d'},
		    {id:6,emotion:'relaxed',color:'#9673b9'},
		    {id:7,emotion:'happy',color:'#7753d4'},
		    {id:8,emotion:'silly',color:'#f769e2'},
		    {id:9,emotion:'blurry',color:'#5e7c7f'},
		    {id:10,emotion:'productive',color:'#2ebec2'},
		    {id:11,emotion:'excited',color:'#1979dc'},
		    {id:12,emotion:'nostalgic',color:'#a4e435'},
		]

		const people1key=[
		    {id:1,people1:'alone',color:'#0c0c04'},
		    {id:2,people1:'with boyfriedn',color:'#0c0c04'},
		    {id:3,people1:'with friend(s)',color:'#0c0c04'},
		    {id:4,people1:'with coworker/clients',color:'#0c0c04'},
		]

		const situationkey=[
		    {id:1,situation:'work'},
		    {id:2,situation:'other'},
		    {id:3,situation:'life'},
		]

		const jobkey=[
		    {id:1,job:'email'},
		    {id:2,job:'working on project'},
		    {id:3,job:'talking about work'},
		    {id:4,job:'dear data'},
		    {id:5,job:'meetings'},
		    {id:6,job:'waiting for something'},
		    {id:7,job:'walking'},
		    {id:8,job:'morning preparation'},
		    {id:9,job:'lunch/dinner'},
		    {id:10,job:'shopping'},
		    {id:11,job:'spa'},
		    {id:12,job:'events'},
		    {id:13,job:'couch'},
		    {id:14,job:'planning'},
		]



	</script>

</body>